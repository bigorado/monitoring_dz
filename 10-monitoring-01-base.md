# Домашнее задание к занятию 13 «Введение в мониторинг»

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. 
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

2. Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

3. Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

3. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. 
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

Ответы:

1. Пропускная способность (Throughput): Метрика, отображающая количество запросов, обрабатываемых платформой в единицу времени. Она позволяет оценить эффективность обработки запросов и измерить производительность платформы.

Среднее время отклика (Average Response Time): Метрика, показывающая среднее время, требуемое для обработки запроса платформой. Это важная метрика, которая позволяет оценить производительность системы и идентифицировать возможные узкие места.

Количество ошибок (Error Rate): Метрика, отображающая количество ошибок, возникающих в процессе обработки запросов. Это может включать ошибки HTTP, ошибки в приложении или другие проблемы, которые могут влиять на работу платформы. Эта метрика позволяет оперативно обнаруживать проблемы и принимать меры для их устранения.

Загрузка ЦПУ (CPU Load): Метрика, отражающая процент использования ЦПУ платформой. Загрузка ЦПУ может быть связана с интенсивностью вычислений и может помочь выявить возможные узкие места или проблемы производительности.

Количество сохраненных отчетов (Number of Saved Reports): Метрика, отображающая количество успешно сохраненных отчетов на диск. Она позволяет отслеживать объем работы, выполняемой платформой, и убедиться, что сохранение отчетов работает должным образом.

Данный минимальный набор метрик позволяет оценить производительность, стабильность и эффективность работы платформы для вычислений с текстовыми отчетами. Он позволяет оперативно реагировать на проблемы, связанные с производительностью и доступностью, а также обеспечивает информацию для планирования масштабирования и оптимизации системы.

2. Если менеджеру продукта непонятны технические термины, связанные с метриками RAM, inodes и CPU load, можно предложить следующие альтернативные метрики и подходы для оценки выполнения обязанностей перед клиентами и качества обслуживания:

Время отклика (Response Time): Метрика, показывающая время, требуемое для обработки запроса платформой. Она измеряется в миллисекундах и позволяет оценить скорость, с которой платформа отвечает на запросы клиентов. Низкое время отклика указывает на быстрое и отзывчивое обслуживание.

Количество успешно выполненных запросов (Successful Requests): Метрика, отображающая количество запросов, которые были успешно обработаны платформой и привели к ожидаемому результату. Это позволяет оценить надежность и стабильность работы платформы.

Количество ошибок (Error Rate): Метрика, отображающая количество ошибок, возникших при обработке запросов. Это может включать ошибки HTTP, ошибки в приложении или другие проблемы, которые могут влиять на работу платформы. Низкий уровень ошибок указывает на высокое качество обслуживания.

Время выполнения задач (Task Execution Time): Если платформа выполняет задачи на вычисление, можно измерить время, затраченное на выполнение каждой задачи. Это позволит оценить скорость и эффективность вычислений, а также убедиться, что задачи завершаются в разумные сроки.

Количество клиентских обращений (Customer Support Tickets): Метрика, отображающая количество обращений клиентов в службу поддержки. Она позволяет оценить, насколько активно клиенты обращаются за помощью и поддержкой, что может свидетельствовать о возникновении проблем или недостаточной ясности в документации.

3. В ситуации, когда отсутствует финансирование на построение системы сбора логов, можно рассмотреть следующее решение, чтобы разработчики все же получали ошибки приложения:

Логирование в файлы: Разработчики могут настроить свои приложения на запись ошибок в файлы журналов. Это простое и доступное решение, которое позволит разработчикам получать информацию об ошибках в приложении. Файлы журналов могут быть организованы с определенной структурой, чтобы облегчить анализ и поиск ошибок.

Отправка ошибок по электронной почте: Разработчики могут добавить функциональность отправки ошибок на электронную почту, которая будет получать уведомления о возникших ошибках. При наличии электронного адреса, на который должны отправляться ошибки, приложение может формировать и отправлять сообщения с информацией об ошибках.

Использование сторонних сервисов: Существуют сторонние сервисы, такие как Sentry, Bugsnag или Rollbar, которые предоставляют инструменты для сбора и мониторинга ошибок в приложениях. Многие из них предоставляют бесплатные планы с ограниченными возможностями, которые могут быть полезными для начала. Разработчики могут использовать такие сервисы для получения ошибок и трассировки стека.

Важно учитывать, что вышеуказанные решения могут быть недостаточными для полноценной системы сбора и анализа логов, но они позволят разработчикам получать информацию об ошибках приложения и реагировать на них. В долгосрочной перспективе рекомендуется стремиться к созданию более развитой системы сбора и мониторинга логов, что поможет улучшить процесс разработки и обслуживания приложения.

4. Следующие аспекты следует проверить для выявления возможной ошибки:

Подсчет всех запросов: Убедитесь, что в подсчете общего количества запросов учитываются все запросы, включая успешные (2xx), ошибочные (4xx) и серверные ошибки (5xx). Если какие-то категории запросов исключены из общего числа, это может привести к неверным результатам при вычислении SLA.

Корректное учет HTTP-кодов: Проверьте, что все коды ответов правильно учитываются в подсчете метрики. Убедитесь, что не происходит исключения каких-либо кодов из рассмотрения или что коды не смешиваются между разными категориями (например, 4xx и 5xx считаются как успешные 2xx).

Точность данных: Проверьте, что данные о количестве запросов и кодах ответов достоверны и актуальны. Некорректный сбор или передача данных может привести к искажению метрик и неправильному вычислению SLA.

Конфигурация мониторинга: Убедитесь, что система мониторинга правильно настроена для сбора данных о кодах ответов и выполнении SLA. Проверьте правильность конфигурации и наличие достаточной гранулярности мониторинга.